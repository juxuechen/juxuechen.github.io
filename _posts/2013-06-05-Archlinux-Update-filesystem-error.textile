---
layout: post
title: Archlinux Update Filesystem Error /bin
---

<h3>Using Target-Action</h3>

Senin, 3 Juni 2013 <a href="http://allanmcrae.com">Allan McRae</a> membuat <a href="https://www.archlinux.org/news/binaries-move-to-usrbin-requiring-update-intervention">pemberitahuan</a> lewat situs resmi Archlinux, bahwa mulai hari itu seluruh <i>binary packages</i> yang selama ini terpencar di direktori <code>/bin</code>, <code>/sbin</code>, <code>/usr/sbin</code> akan dirapikan dan semua akan dimasukkan dalam satu direktori di <code>/usr/bin</code>.

Hal ini akan berpengaruh sekali saat <i>update</i> <code>pacman</code>, biasanya setelah <i>update</i> akan mendapatkan <i>error</i> seperti berikut :

	<pre>
	<code>
	error: failed to commit transaction (conflicting files)
	filesystem: /bin exists in filesystem
	filesystem: /sbin exists in filesystem
	filesystem: /usr/sbin exists in filesystem
		</code>
	</pre>

Hal ini berarti bahwa ada paket binary dari aplikasi yang terletak pada direktori tersebut diatas. Oleh karena <code>pacman</code> tidak bisa memindahkannya secara otomatis, maka diperlukan campur tangan pengguna untuk memindahkan secara manual. Kebetulan aye juga mendapatkan <i>error</i> tersebut. Sehingga perlu dilakukan langkah - langkah perbaikan ( pemindahan secara manual ) dengan cara seperti yang sudah diberitahukan oleh Allan.

<ol>
	<li>Pindahkan seluruh paket binari yang ada di direktori <code>/bin</code>, <code>/sbin</code>, <code>/usr/sbin</code></li>

	Untuk mengeceknya atau melihat binary apa saja yg masuk ke direktori tersebut bisa dilakukan dengan mempegunakan perintah ini :

	<pre>
	<code>
	$ pacman -Qqo /bin /sbin /usr/sbin | pacman -Qm -
	</code>
	</pre>

	Hasil perintah ini di mesin aye adalah :

	<pre>
	<code>
	$ pacman -Qqo /bin /sbin /usr/sbin | pacman -Qm -
	grub
	gen_init_cpio
	dcron
	tcp_wrapper
	</code>
	</pre>

	Nah, dari hasil tersebut maka perlu dipindah ke direktori <code>/usr/bin</code>. Untuk mengetahui berkas mana saja yang harus dipindah, bisa mempergunakan perintah berikut : 

	<pre>
	<code>
	$ paclist mypac | awk ' { print $1 } ' | pacman -Ql - | grep ' /s\?bin/\| /usr/sbin/'
	</code>
	</pre>

	yang akan menampilkan daftar paket binari dan nama berkas serta letaknya, dalam hal ini akan menampilkan hasil sebagai berikut :

	<pre>
	<code>
	...
	dcron /usr/sbin/
	dcron /usr/sbin/crond
	dcron /usr/sbin/run-cron
	...
	gen-init-cpio /sbin/
	gen-init-cpio /sbin/gen_init_cpio
	...
	grub /bin/mbchk
	grub /sbin/
	grub /sbin/grub
	grub /sbin/grub-install
	grub /sbin/grub-md5-crypt
	grub /sbin/grub-set-default
	grub /sbin/grub-terminfo
	grub /sbin/install-grub
	...
	tcp_wrappers /usr/sbin/
	tcp_wrappers /usr/sbin/safe_finger
	tcp_wrappers /usr/sbin/tcpd
	tcp_wrappers /usr/sbin/tcpdchk
	tcp_wrappers /usr/sbin/tcpdmatch
	tcp_wrappers /usr/sbin/try-from
	...
	</code>
	</pre>

	Setelah ini, tinggal kita pindahkan semua berkas tersebut ke direktori <code>/usr/bin</code> secara manual ( dengan <code>root</code> akses ).

	Jika ada paket yang di pasang bukan dari <i>official repo</i> tapi juga mempergunakan direktori <code>/bin</code>, <code>/sbin</code>, <code>/usr/sbin</code> maka juga perlu dipindah, cara melihat paket dan berkas apa saja, bisa mempergunakan perintah :

	<pre>
	<code>
	$ paclist repo | awk ' { print $1 } ' | pacman -Ql - | grep ' /s\?bin/\| /usr/sbin/'
	</code>
	</pre>

	Sebagai catatan perintah <code>"repo"</code> tersebut diatas adalah nama repo asal kita memasang paket. Contoh misal Repo Archlinuxfr dll.

	<li>Cek dan yakinkan bahwa tidak ada paket di <code>IgnorePkg</code> atau <code>IgnoreGroup</code> di <code>pacman.conf</code> yang juga mempergunakan direktori <code>/bin</code>, <code>/sbin</code>, <code>/usr/sbin</code>.</li>

	<li> Periksa juga bahwa tidak ada berkas di <code>/bin</code>, <code>/sbin</code>, <code>/usr/sbin</code> yang tidak dimiliki oleh paket apapun, ini juga perlu di pindah. </li>

	Biasanya ada beberapa paket yang ada di direktori tersebut yang ternyata tidak dimiliki oleh paket apapun, dan ini perlu dipindah juga secara manual. Cara untuk memeriksa berkas tersebut adalah dengan perintah :

	<pre>
	<code>
	$ find /bin /sbin /usr/sbin -exec pacman -Qo -- {} + >/dev/null
	</code>
	</pre>

	<li>Update system</li>

	Setelah semua yakin selesai, sistem baru bisa di <i>update</i> dengan berurutan.

	<pre>
	<code>
	# pacman -Syu --ignore filesystem,bash
	# pacman -S bash
	# pacman -Su
	</code>
	</pre>


	Biasanya setelah perintah <code> # pacman -Su </code> masih akan ada error seperti tersebut diatas, karena itu perlu dicek ulang direktori <code>/bin</code>, <code>/sbin</code>, <code>/usr/sbin</code> . Jika ditemukan dan didalamnya ternyata kosong, direktori tersebut bisa dihapus secara manual. Baru kemudian perintah tersebut diulang.

	Ada baiknya juga melakukan pembaharuan paket dari <a href="https://aur.archlinux.org">AUR</a> sekalian.

</ol>

Pacman memang paket manajer yang bagus, namun memang ada kalanya perlu intervensi manual untuk melakukan <i>update</i> sistem, celakanya biasanya intervensi ini tidak mudah dilakukan. Sebagai contoh saat ada perubahan di <a href="https://www.archlinux.org/news/update-filesystem-201301-1-and-glibc-217-2-together">glibc</a> yang dahulu. Banyak sekali pengguna Archlinux yang kesusahan dan gagal dalam update. Bahkan ada yang sampai sistemnya tidak bisa <i>booting</i> atau rusak.

Oleh karena itu, semoga dengan tulisan ini, bisa membantu pengguna Archlinux khususnya dari Indonesia untuk memudahkan dalam pelaksanaan proses migrasi <code>/bin</code> ini. fnd

